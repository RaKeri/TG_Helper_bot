
# TG_Helper  
Бот, который помогает автоматизировать ведение каналов в мессенджере Телеграм

---

## Описание

**TG_Helper** — это инструмент для автоматизации ведения каналов в Telegram. С его помощью можно:
- Автоматически пересылать новые сообщения из выбранных каналов с возможностью применения фильтров.
- Парсить участников каналов и сохранять их данные в CSV-файл.
- Пересылать старые сообщения с фильтрацией по типу контента и медиагруппам.
- Загружать медиафайлы и сохранять сообщения в CSV с прогресс-отчетом (отправляемым через Telegram Bot API).

В основе работы TG_Helper лежит библиотека [Telethon](https://github.com/LonamiWebs/Telethon) для взаимодействия с Telegram API, а также [Aiogram](https://docs.aiogram.dev/) для реализации интерфейса бота.

---

## Функциональные возможности

- **Автоматическая пересылка сообщений (Action1):**  
  Отслеживание новых сообщений из выбранных источников и пересылка их в целевые чаты с возможностью:
  - Удаления или полного исключения ссылок.
  - Удаления текста.
  - Перевода текста на другой язык.
  - Добавления ссылки-источника в конец сообщения.
  
- **Парсинг участников (Action2):**  
  Сбор информации об участниках канала (ID, username, имя, фамилия, телефон) и сохранение данных в CSV-файл.

- **Пересылка старых сообщений (Action3):**  
  Обработка и пересылка старых сообщений с учётом фильтров по типам медиа и тексту. Поддерживается работа с медиагруппами, а также фильтрация по ключевым словам.

- **Скачивание медиа и сохранение сообщений в CSV (Action4):**  
  Загрузка медиафайлов из сообщений, сохранение информации (ID сообщения, отправитель, текст, путь к файлу) в CSV с отправкой сообщений о прогрессе через Telegram Bot API.

- **Обработка различных типов медиа:**  
  Поддерживаются фотографии, видео (в том числе видеосообщения и видеогифки), аудио, голосовые сообщения, документы и другие форматы.

- **Дополнительные возможности:**  
  - Извлечение первого кадра из видео (с помощью OpenCV).  
  - Получение длительности аудиофайлов (с помощью Mutagen).  
  - Возможная транскрибация аудио/видео (функциональность, которая может быть доработана).  
  - Интеграция с внешними модулями для перевода текста и конвертации медиа.

---

## Структура проекта

Проект состоит из нескольких ключевых компонентов:

- **Основной бот (на основе Aiogram):**  
  Управляет пользовательским интерфейсом, состоянием и взаимодействием с пользователями через команды Telegram.

- **Telethon Worker (TG_Helper):**  
  Основной модуль автоматизации, реализующий следующие действия:
  - **Action1:** Отслеживание новых сообщений и их пересылка с применением фильтров.
  - **Action2:** Парсинг участников канала и сохранение данных в CSV.
  - **Action3:** Пересылка старых сообщений с фильтрацией по типу контента.
  - **Action4:** Скачивание медиафайлов и сохранение сообщений в CSV с прогресс-отчетами.

- **Дополнительные утилиты и модули:**  
  В проекте также присутствуют модули для:
  - Перевода текста (например, с использованием Google Translate).
  - Конвертации медиафайлов.
  - Работа с базой данных SQLite (хранение информации об аккаунтах и настройках).
  - Создания QR-кодов для авторизации.
  - Проверки и использования прокси-серверов.

---

## Установка

### 1. Клонирование репозитория

```bash
git clone https://github.com/RaKeri/TG_Helper_bot.git
cd TG_Helper_bot
```

### 2. Создание виртуального окружения (рекомендуется)

```bash
python -m venv venv
# Для Linux/macOS:
source venv/bin/activate
# Для Windows:
venv\Scripts\activate
```

### 3. Установка зависимостей

Убедитесь, что у вас установлен Python 3.10+.

**Основные зависимости:**
- `aiogram`
- `telethon`
- `opencv-python`
- `mutagen`
- `python-dotenv`
- и другие (подробнее в файле `requirements.txt`).

### 4. Настройка переменных окружения

Создайте файл `.env` в корневой директории проекта и добавьте следующие переменные:

```env
BOT_TOKEN=ваш_токен_бота
ME_ID=ваш_telegram_id
API_ID=ваш_api_id
API_HASH=ваш_api_hash
```

При необходимости добавьте дополнительные переменные для настройки прокси или других сервисов.

### 5. Инициализация базы данных

Убедитесь, что в корневой директории присутствует файл базы данных (например, `database.db`) с необходимыми таблицами (такими как `accounts` и `url`). Если база данных отсутствует, создайте её и настройте таблицы согласно требованиям проекта.

---

## Использование

### Запуск основного бота

Основной бот запускается из отдельного файла (например, `main.py`). Для его запуска выполните:

```bash
python main.py
```

Бот будет принимать команды и управлять состоянием через интерфейс Aiogram. Telethon Worker запускается в отдельных процессах для выполнения задач автоматизации.

### Запуск Telethon Worker

Telethon Worker (основной модуль автоматизации) запускается автоматически при выборе соответствующего действия в боте. Функция `startGrab` считывает настройки аккаунта из базы данных и инициирует выполнение одного из следующих действий:
- **Action1:** Мониторинг и пересылка новых сообщений.
- **Action2:** Парсинг участников канала.
- **Action3:** Пересылка старых сообщений.
- **Action4:** Скачивание медиа и сохранение сообщений в CSV.

Каждое действие обрабатывается в отдельном процессе, что позволяет параллельно выполнять несколько задач.

---

*TG_Helper* — ваш помощник для автоматизации работы с Telegram-каналами!
